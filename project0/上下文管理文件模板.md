# IoT架构开发上下文管理文件

## 文档元数据

```yaml
---
context_id: "CTX-001"
title: "主上下文管理文件"
version: "1.0"
created_date: "2025-06-25"
updated_date: "2025-06-25"
status: "active"
priority: "high|medium|low"
owner: "owner_name"
contributors: ["contributor1", "contributor2"]
tags: ["tag1", "tag2", "tag3"]
linked_contexts: ["CTX-002", "CTX-003"]
---
```

## 1. 上下文概述

### 1.1 当前焦点

[简要描述当前正在处理的主要任务或问题]

### 1.2 背景信息

[提供理解当前上下文所需的背景信息]

### 1.3 目标和预期成果

[列出当前上下文中要实现的具体目标和预期成果]

## 2. 知识状态

### 2.1 已掌握概念

| 概念ID | 概念名称 | 掌握程度 | 关键理解点 |
|-------|---------|---------|-----------|
| CONCEPT-001 | [概念名称] | 完全/部分/初步 | [关键理解] |
| CONCEPT-002 | [概念名称] | 完全/部分/初步 | [关键理解] |

### 2.2 待深入研究概念

| 概念ID | 概念名称 | 优先级 | 研究方向 |
|-------|---------|-------|---------|
| CONCEPT-003 | [概念名称] | 高/中/低 | [研究方向] |
| CONCEPT-004 | [概念名称] | 高/中/低 | [研究方向] |

### 2.3 知识图谱位置

[描述当前上下文在整体知识图谱中的位置，可使用路径表示]
例如：核心架构 > 微服务 > 服务发现

## 3. 工作状态

### 3.1 已完成工作

| 任务ID | 任务描述 | 完成日期 | 成果链接 |
|-------|---------|---------|---------|
| TASK-001 | [任务描述] | 2025-06-24 | [链接] |
| TASK-002 | [任务描述] | 2025-06-25 | [链接] |

### 3.2 进行中工作

| 任务ID | 任务描述 | 开始日期 | 预计完成 | 完成度 | 阻碍因素 |
|-------|---------|---------|---------|-------|---------|
| TASK-003 | [任务描述] | 2025-06-25 | 2025-06-26 | 50% | [阻碍因素] |
| TASK-004 | [任务描述] | 2025-06-25 | 2025-06-27 | 20% | [阻碍因素] |

### 3.3 待处理工作

| 任务ID | 任务描述 | 优先级 | 依赖任务 |
|-------|---------|-------|---------|
| TASK-005 | [任务描述] | 高/中/低 | TASK-003 |
| TASK-006 | [任务描述] | 高/中/低 | - |

## 4. 资源状态

### 4.1 关键文档

| 文档ID | 文档名称 | 位置 | 重要性 | 最后访问 |
|-------|---------|-----|-------|---------|
| DOC-001 | [文档名称] | [路径/链接] | 高/中/低 | 2025-06-25 |
| DOC-002 | [文档名称] | [路径/链接] | 高/中/低 | 2025-06-24 |

### 4.2 代码资源

| 代码ID | 描述 | 位置 | 状态 | 最后修改 |
|-------|-----|-----|-----|---------|
| CODE-001 | [代码描述] | [路径/链接] | 稳定/进行中/计划 | 2025-06-25 |
| CODE-002 | [代码描述] | [路径/链接] | 稳定/进行中/计划 | 2025-06-24 |

### 4.3 外部资源

| 资源ID | 资源名称 | 链接 | 用途 |
|-------|---------|-----|-----|
| RES-001 | [资源名称] | [链接] | [用途描述] |
| RES-002 | [资源名称] | [链接] | [用途描述] |

## 5. 思考状态

### 5.1 当前思路

[详细描述当前正在探索的思路、方法或解决方案]

### 5.2 关键问题

| 问题ID | 问题描述 | 状态 | 相关概念 |
|-------|---------|-----|---------|
| QUES-001 | [问题描述] | 待解决/部分解决/已解决 | [相关概念] |
| QUES-002 | [问题描述] | 待解决/部分解决/已解决 | [相关概念] |

### 5.3 假设与验证

| 假设ID | 假设描述 | 验证方法 | 验证状态 |
|-------|---------|---------|---------|
| HYP-001 | [假设描述] | [验证方法] | 未验证/部分验证/已验证/已否定 |
| HYP-002 | [假设描述] | [验证方法] | 未验证/部分验证/已验证/已否定 |

### 5.4 决策记录

| 决策ID | 决策描述 | 决策理由 | 决策日期 | 替代方案 |
|-------|---------|---------|---------|---------|
| DEC-001 | [决策描述] | [决策理由] | 2025-06-24 | [替代方案] |
| DEC-002 | [决策描述] | [决策理由] | 2025-06-25 | [替代方案] |

## 6. 上下文切换

### 6.1 中断原因

[如果此上下文是由于中断而保存，记录中断原因]

### 6.2 恢复点

[详细描述恢复工作时应从何处开始，包括具体文件、代码行、思考点等]

### 6.3 恢复所需信息

[列出恢复工作所需的关键信息，如环境设置、参数值、测试数据等]

### 6.4 下一步行动

[明确列出恢复后应立即执行的具体行动]

## 7. 相关上下文

### 7.1 父上下文

| 上下文ID | 上下文名称 | 关系类型 | 链接 |
|---------|-----------|---------|-----|
| CTX-000 | [上下文名称] | 父上下文 | [链接] |

### 7.2 子上下文

| 上下文ID | 上下文名称 | 关系类型 | 链接 |
|---------|-----------|---------|-----|
| CTX-002 | [上下文名称] | 子上下文 | [链接] |
| CTX-003 | [上下文名称] | 子上下文 | [链接] |

### 7.3 相关上下文

| 上下文ID | 上下文名称 | 关系类型 | 链接 |
|---------|-----------|---------|-----|
| CTX-004 | [上下文名称] | 参考/依赖/影响 | [链接] |
| CTX-005 | [上下文名称] | 参考/依赖/影响 | [链接] |

## 8. 备注与附录

### 8.1 一般备注

[任何不适合放在其他部分的重要信息]

### 8.2 参考资料

[列出与当前上下文相关的参考资料]

### 8.3 术语表

| 术语 | 定义 | 来源 |
|-----|-----|-----|
| [术语1] | [定义] | [来源] |
| [术语2] | [定义] | [来源] |

---

## 使用说明

1. 本模板用于记录和管理IoT架构开发过程中的工作上下文
2. 在开始新工作或中断当前工作时更新此文件
3. 确保所有字段都有清晰、具体的内容
4. 定期审查和更新上下文文件，保持信息最新
5. 使用版本控制系统管理上下文文件的变更

## 模板示例：微服务架构开发上下文

```yaml
---
context_id: "CTX-001"
title: "微服务架构设计上下文"
version: "1.0"
created_date: "2025-06-25"
updated_date: "2025-06-25"
status: "active"
priority: "high"
owner: "architect1"
contributors: ["developer1", "developer2"]
tags: ["architecture", "microservices", "design"]
linked_contexts: ["CTX-002", "CTX-003"]
---
```

```markdown
## 1. 上下文概述

### 1.1 当前焦点

设计IoT设备管理平台的微服务架构，确定服务边界和通信模式。

### 1.2 背景信息

项目需要支持大规模IoT设备的管理，包括设备注册、状态监控、固件更新等功能。系统预计需要处理10万+设备的并发连接，并支持灵活的扩展。

### 1.3 目标和预期成果

1. 定义微服务架构的整体结构
2. 确定核心服务及其职责
3. 设计服务间通信模式
4. 制定服务发现策略
5. 完成架构设计文档初稿

## 2. 知识状态

### 2.1 已掌握概念

| 概念ID | 概念名称 | 掌握程度 | 关键理解点 |
|-------|---------|---------|-----------|
| CONCEPT-001 | 微服务架构 | 完全 | 服务独立性、通信机制、弹性设计 |
| CONCEPT-005 | API网关模式 | 完全 | 请求路由、聚合、认证授权 |
| CONCEPT-008 | 服务发现 | 部分 | 客户端发现、服务端发现对比 |

### 2.2 待深入研究概念

| 概念ID | 概念名称 | 优先级 | 研究方向 |
|-------|---------|-------|---------|
| CONCEPT-012 | 事件驱动架构 | 高 | 与微服务的集成方式 |
| CONCEPT-015 | 服务网格 | 中 | 是否适用于当前规模 |

### 2.3 知识图谱位置

核心架构 > 微服务架构 > IoT应用

## 3. 工作状态

### 3.1 已完成工作

| 任务ID | 任务描述 | 完成日期 | 成果链接 |
|-------|---------|---------|---------|
| TASK-001 | 微服务架构调研 | 2025-06-23 | docs/research/microservice_research.md |
| TASK-002 | 需求分析 | 2025-06-24 | docs/requirements/iot_platform_req.md |

### 3.2 进行中工作

| 任务ID | 任务描述 | 开始日期 | 预计完成 | 完成度 | 阻碍因素 |
|-------|---------|---------|---------|-------|---------|
| TASK-003 | 服务边界定义 | 2025-06-25 | 2025-06-26 | 60% | 设备管理与监控服务职责划分不清 |
| TASK-004 | 通信模式设计 | 2025-06-25 | 2025-06-27 | 30% | 需要确定消息队列选型 |

### 3.3 待处理工作

| 任务ID | 任务描述 | 优先级 | 依赖任务 |
|-------|---------|-------|---------|
| TASK-005 | 服务发现机制设计 | 高 | TASK-003 |
| TASK-006 | 数据一致性策略 | 中 | TASK-003, TASK-004 |

## 4. 资源状态

### 4.1 关键文档

| 文档ID | 文档名称 | 位置 | 重要性 | 最后访问 |
|-------|---------|-----|-------|---------|
| DOC-001 | 系统需求规格说明书 | docs/requirements/SRS.md | 高 | 2025-06-25 |
| DOC-002 | 微服务最佳实践 | docs/standards/microservice_best_practices.md | 高 | 2025-06-24 |

### 4.2 代码资源

| 代码ID | 描述 | 位置 | 状态 | 最后修改 |
|-------|-----|-----|-----|---------|
| CODE-001 | 服务发现原型 | code/prototypes/service-discovery/ | 进行中 | 2025-06-25 |
| CODE-002 | API网关配置 | code/prototypes/api-gateway/ | 计划 | - |

### 4.3 外部资源

| 资源ID | 资源名称 | 链接 | 用途 |
|-------|---------|-----|-----|
| RES-001 | 微服务模式 | https://microservices.io/patterns | 架构参考 |
| RES-002 | MQTT规范 | https://mqtt.org/mqtt-specification/ | 设备通信协议参考 |

## 5. 思考状态

### 5.1 当前思路

正在考虑采用领域驱动设计方法确定服务边界，将系统划分为设备管理、设备监控、用户管理、固件管理、数据分析等核心服务。服务间通信采用混合模式，同步请求使用REST API，异步通信使用消息队列。

### 5.2 关键问题

| 问题ID | 问题描述 | 状态 | 相关概念 |
|-------|---------|-----|---------|
| QUES-001 | 如何处理设备离线状态下的命令队列 | 部分解决 | 消息队列、状态管理 |
| QUES-002 | 大规模设备并发连接的性能瓶颈 | 待解决 | 负载均衡、水平扩展 |

### 5.3 假设与验证

| 假设ID | 假设描述 | 验证方法 | 验证状态 |
|-------|---------|---------|---------|
| HYP-001 | MQTT协议适用于所有类型的设备通信 | 原型测试不同设备类型 | 部分验证 |
| HYP-002 | 每个微服务独立数据库可以保证最终一致性 | 设计事件驱动更新机制并测试 | 未验证 |

### 5.4 决策记录

| 决策ID | 决策描述 | 决策理由 | 决策日期 | 替代方案 |
|-------|---------|---------|---------|---------|
| DEC-001 | 采用API网关模式 | 统一入口点，简化客户端，增强安全性 | 2025-06-24 | 直接服务访问 |
| DEC-002 | 使用Consul进行服务发现 | 支持健康检查，易于集成 | 2025-06-25 | Eureka, etcd |

## 6. 上下文切换

### 6.1 中断原因

需要参加团队会议讨论数据存储策略。

### 6.2 恢复点

返回继续完成服务边界定义文档（docs/design/service_boundaries.md），特别是设备管理与监控服务的职责划分部分。

### 6.3 恢复所需信息

1. 领域模型图（docs/design/domain_model.png）
2. 设备状态定义（docs/requirements/device_states.md）
3. 当前服务边界草图（docs/design/service_boundaries_draft.md）

### 6.4 下一步行动

1. 完成设备管理与监控服务的职责划分
2. 更新服务交互图
3. 开始设计API网关路由规则

## 7. 相关上下文

### 7.1 父上下文

| 上下文ID | 上下文名称 | 关系类型 | 链接 |
|---------|-----------|---------|-----|
| CTX-000 | IoT平台总体架构 | 父上下文 | docs/contexts/CTX-000.md |

### 7.2 子上下文

| 上下文ID | 上下文名称 | 关系类型 | 链接 |
|---------|-----------|---------|-----|
| CTX-002 | 设备管理服务设计 | 子上下文 | docs/contexts/CTX-002.md |
| CTX-003 | API网关设计 | 子上下文 | docs/contexts/CTX-003.md |

### 7.3 相关上下文

| 上下文ID | 上下文名称 | 关系类型 | 链接 |
|---------|-----------|---------|-----|
| CTX-004 | 数据存储策略 | 依赖 | docs/contexts/CTX-004.md |
| CTX-005 | 安全架构设计 | 影响 | docs/contexts/CTX-005.md |

## 8. 备注与附录

### 8.1 一般备注

团队决定采用增量式开发，先实现核心设备管理功能，后续迭代添加高级功能。

### 8.2 参考资料

1. Newman, S. (2021). Building Microservices (2nd ed.). O'Reilly Media.
2. Richardson, C. (2018). Microservices Patterns. Manning Publications.

### 8.3 术语表

| 术语 | 定义 | 来源 |
|-----|-----|-----|
| 服务网格 | 专注于处理服务间通信的基础设施层 | Istio文档 |
| 断路器 | 防止级联故障的稳定性模式 | Netflix Hystrix | 
```
